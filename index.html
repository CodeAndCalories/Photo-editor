<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMIX ‚Äî Social Photo Editor</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;1,9..40,300&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --panel: #111118;
    --panel2: #18181f;
    --border: #2a2a38;
    --accent: #ff3c6e;
    --accent2: #ffb830;
    --accent3: #00e5c5;
    --text: #f0f0fa;
    --muted: #666680;
    --gold: #ffb830;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* GRAIN OVERLAY */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32px;
    height: 60px;
    border-bottom: 1px solid var(--border);
    background: rgba(10,10,15,0.95);
    backdrop-filter: blur(20px);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 4px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-dot {
    width: 8px; height: 8px;
    background: var(--accent);
    border-radius: 50%;
    box-shadow: 0 0 12px var(--accent);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,100% { opacity:1; transform: scale(1); }
    50% { opacity:0.5; transform: scale(0.8); }
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .badge-free {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 4px 10px;
    border: 1px solid var(--border);
    border-radius: 20px;
    color: var(--muted);
    letter-spacing: 1px;
  }

  .btn-pro {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    padding: 8px 18px;
    background: linear-gradient(135deg, var(--accent), #ff7a00);
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    letter-spacing: 1px;
    font-weight: 700;
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .btn-pro:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(255,60,110,0.4); }

  /* MAIN LAYOUT */
  .app {
    display: grid;
    grid-template-columns: 220px 1fr 260px;
    height: calc(100vh - 60px);
  }

  /* LEFT PANEL */
  .left-panel {
    background: var(--panel);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .panel-section {
    padding: 16px;
    border-bottom: 1px solid var(--border);
  }

  .panel-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* PRESETS */
  .presets-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .preset-btn {
    position: relative;
    aspect-ratio: 1;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s, transform 0.15s;
    background: var(--panel2);
  }

  .preset-btn:hover { transform: scale(1.04); }
  .preset-btn.active { border-color: var(--accent); }
  .preset-btn.pro-locked::after {
    content: '‚ú¶ PRO';
    position: absolute;
    top: 4px; right: 4px;
    font-family: 'Space Mono', monospace;
    font-size: 7px;
    background: var(--gold);
    color: #000;
    padding: 2px 5px;
    border-radius: 2px;
    font-weight: 700;
  }

  .preset-thumb {
    width: 100%;
    height: 70%;
    display: block;
    object-fit: cover;
  }

  .preset-canvas {
    width: 100%;
    height: 70%;
    display: block;
  }

  .preset-name {
    font-size: 9px;
    font-family: 'Space Mono', monospace;
    text-align: center;
    padding: 5px 2px;
    color: var(--muted);
    letter-spacing: 1px;
  }

  /* FRAMES */
  .frames-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }

  .frame-btn {
    aspect-ratio: 1;
    border: 1px solid var(--border);
    border-radius: 4px;
    cursor: pointer;
    background: var(--panel2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.15s;
    position: relative;
  }
  .frame-btn:hover { border-color: var(--accent3); background: rgba(0,229,197,0.08); }
  .frame-btn.active { border-color: var(--accent3); box-shadow: 0 0 10px rgba(0,229,197,0.2); }

  /* CENTER */
  .center {
    background: #06060a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  .center-bg {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(255,60,110,0.06) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 30%, rgba(0,229,197,0.05) 0%, transparent 60%);
  }

  .drop-zone {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    text-align: center;
  }

  .drop-zone-label {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 48px;
    letter-spacing: 6px;
    opacity: 0.12;
    line-height: 1;
  }

  .drop-zone-sub {
    color: var(--muted);
    font-size: 13px;
    font-weight: 300;
  }

  .btn-upload {
    margin-top: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    padding: 12px 28px;
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    border-radius: 4px;
    cursor: pointer;
    letter-spacing: 2px;
    transition: all 0.2s;
  }
  .btn-upload:hover {
    background: var(--accent);
    color: white;
    box-shadow: 0 0 30px rgba(255,60,110,0.3);
  }

  #file-input { display: none; }

  /* CANVAS AREA */
  .canvas-wrapper {
    position: relative;
    z-index: 2;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    max-width: 90%;
    max-height: 90%;
  }

  .canvas-wrapper.visible { display: flex; }

  #main-canvas {
    max-width: 100%;
    max-height: calc(100vh - 200px);
    border-radius: 4px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.8), 0 0 0 1px var(--border);
    cursor: crosshair;
  }

  .canvas-actions {
    display: flex;
    gap: 10px;
  }

  .btn-action {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 8px 16px;
    background: var(--panel);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 4px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .btn-action:hover { border-color: var(--accent3); color: var(--accent3); }

  .btn-export {
    background: linear-gradient(135deg, #00e5c5, #0070ff);
    border-color: transparent;
    color: white;
    font-weight: 700;
  }
  .btn-export:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,229,197,0.3); border-color: transparent; color: white; }

  /* RIGHT PANEL */
  .right-panel {
    background: var(--panel);
    border-left: 1px solid var(--border);
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  /* SLIDERS */
  .slider-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .slider-label {
    font-size: 11px;
    color: var(--muted);
    width: 90px;
    flex-shrink: 0;
    font-weight: 300;
    letter-spacing: 0.5px;
  }

  .slider-wrap {
    flex: 1;
    position: relative;
  }

  input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }

  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    border: 2px solid var(--accent);
    box-shadow: 0 0 8px rgba(255,60,110,0.5);
    cursor: pointer;
    transition: transform 0.1s;
  }

  input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  .slider-val {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--accent);
    width: 30px;
    text-align: right;
    flex-shrink: 0;
  }

  /* TABS */
  .tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
  }

  .tab {
    flex: 1;
    padding: 12px 8px;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    text-align: center;
    cursor: pointer;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.15s;
  }
  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* TEXT OVERLAY */
  .text-tools { padding: 16px; }

  .text-input-group {
    margin-bottom: 12px;
  }

  .text-input-group label {
    font-size: 9px;
    font-family: 'Space Mono', monospace;
    color: var(--muted);
    display: block;
    margin-bottom: 6px;
    letter-spacing: 1px;
  }

  .text-input-group input,
  .text-input-group select,
  .text-input-group textarea {
    width: 100%;
    background: var(--panel2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 10px;
    border-radius: 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    outline: none;
    transition: border-color 0.15s;
  }
  .text-input-group input:focus,
  .text-input-group textarea:focus { border-color: var(--accent3); }

  .text-input-group textarea { height: 60px; resize: none; }

  .color-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 6px;
  }

  .color-swatch {
    width: 22px; height: 22px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.15s;
  }
  .color-swatch:hover { transform: scale(1.2); }
  .color-swatch.active { border-color: white; }

  .btn-add-text {
    width: 100%;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 10px;
    background: rgba(0,229,197,0.1);
    border: 1px solid var(--accent3);
    color: var(--accent3);
    border-radius: 4px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.15s;
    margin-top: 4px;
  }
  .btn-add-text:hover { background: rgba(0,229,197,0.2); }

  /* STICKERS */
  .stickers-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    padding: 16px;
  }

  .sticker {
    aspect-ratio: 1;
    background: var(--panel2);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    border: 1px solid var(--border);
    transition: all 0.15s;
    position: relative;
  }
  .sticker:hover { transform: scale(1.1); border-color: var(--accent2); }
  .sticker.pro::after {
    content: '‚ú¶';
    position: absolute;
    top: 2px; right: 3px;
    font-size: 6px;
    color: var(--gold);
  }

  /* WATERMARK / AD NOTICE */
  .ad-banner {
    margin: 12px 16px;
    background: linear-gradient(135deg, rgba(255,184,48,0.1), rgba(255,60,110,0.1));
    border: 1px solid rgba(255,184,48,0.3);
    border-radius: 6px;
    padding: 12px;
    text-align: center;
  }
  .ad-banner .ad-label {
    font-family: 'Space Mono', monospace;
    font-size: 7px;
    color: var(--muted);
    letter-spacing: 2px;
    margin-bottom: 4px;
  }
  .ad-banner .ad-text {
    font-size: 11px;
    color: var(--gold);
    font-weight: 600;
  }
  .ad-banner .ad-sub {
    font-size: 10px;
    color: var(--muted);
    margin-top: 2px;
  }

  /* FORMAT BTNS */
  .format-btns {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 6px;
    padding: 12px 16px;
  }

  .format-btn {
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 8px 4px;
    cursor: pointer;
    text-align: center;
    transition: all 0.15s;
  }
  .format-btn:hover { border-color: var(--accent); }
  .format-btn.active { border-color: var(--accent); background: rgba(255,60,110,0.1); }
  .format-btn .fmt-icon {
    display: block;
    margin: 0 auto 4px;
    background: var(--border);
    border-radius: 2px;
  }
  .format-btn .fmt-name {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    color: var(--muted);
    letter-spacing: 0.5px;
  }

  /* PRO MODAL */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(10px);
    z-index: 1000;
    display: none;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 40px;
    max-width: 480px;
    width: 90%;
    position: relative;
    text-align: center;
  }

  .modal-close {
    position: absolute;
    top: 16px; right: 20px;
    background: none;
    border: none;
    color: var(--muted);
    font-size: 20px;
    cursor: pointer;
  }

  .modal h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 40px;
    letter-spacing: 4px;
    margin-bottom: 4px;
  }

  .modal h2 span { color: var(--accent); }

  .modal p {
    color: var(--muted);
    font-size: 13px;
    font-weight: 300;
    margin-bottom: 28px;
    line-height: 1.6;
  }

  .plans {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .plan {
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px 16px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
  }
  .plan:hover, .plan.featured { border-color: var(--accent); background: rgba(255,60,110,0.08); }
  .plan.featured { position: relative; }
  .plan.featured::before {
    content: 'BEST VALUE';
    position: absolute;
    top: -10px; left: 50%;
    transform: translateX(-50%);
    background: var(--accent);
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    padding: 2px 10px;
    border-radius: 20px;
    letter-spacing: 1px;
    white-space: nowrap;
  }
  .plan-price {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    color: var(--text);
    letter-spacing: 2px;
  }
  .plan-period {
    font-size: 10px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
  }
  .plan-features {
    margin-top: 12px;
    list-style: none;
    font-size: 11px;
    color: var(--muted);
    line-height: 2;
  }
  .plan-features li::before { content: '‚úì '; color: var(--accent3); }

  .btn-subscribe {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--accent), #ff7a00);
    border: none;
    border-radius: 6px;
    color: white;
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    letter-spacing: 2px;
    cursor: pointer;
    font-weight: 700;
    transition: all 0.2s;
  }
  .btn-subscribe:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(255,60,110,0.4); }

  .modal-footer {
    margin-top: 12px;
    font-size: 10px;
    color: var(--muted);
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--panel);
    border: 1px solid var(--accent3);
    color: var(--accent3);
    padding: 12px 24px;
    border-radius: 6px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    z-index: 9999;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* SCROLLBAR STYLE */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* HISTOGRAM MINI */
  .histogram-wrap {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
  }
  #histogram { width: 100%; height: 50px; display: block; border-radius: 4px; }

  /* BEFORE/AFTER indicator */
  .ba-hint {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    letter-spacing: 1px;
    text-align: center;
  }

  .compare-btn {
    position: relative;
  }
  .compare-btn.comparing {
    border-color: var(--accent2);
    color: var(--accent2);
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-dot"></div>
    LUMIX
  </div>
  <div class="header-right">
    <span class="badge-free">FREE PLAN</span>
    <button class="btn-pro" onclick="openModal()">‚ú¶ GO PRO</button>
  </div>
</header>

<!-- APP -->
<div class="app">

  <!-- LEFT: Presets & Frames -->
  <div class="left-panel">

    <!-- FORMAT -->
    <div class="panel-section">
      <div class="panel-label">Canvas Format</div>
      <div class="format-btns">
        <div class="format-btn active" onclick="setFormat(this,'square')" title="1:1">
          <svg class="fmt-icon" width="24" height="24" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" fill="none" stroke="#666680" stroke-width="2" rx="2"/></svg>
          <span class="fmt-name">1:1</span>
        </div>
        <div class="format-btn" onclick="setFormat(this,'portrait')" title="4:5">
          <svg class="fmt-icon" width="20" height="26" viewBox="0 0 20 26"><rect x="1" y="1" width="18" height="24" fill="none" stroke="#666680" stroke-width="2" rx="2"/></svg>
          <span class="fmt-name">4:5</span>
        </div>
        <div class="format-btn" onclick="setFormat(this,'story')" title="9:16">
          <svg class="fmt-icon" width="18" height="28" viewBox="0 0 18 28"><rect x="1" y="1" width="16" height="26" fill="none" stroke="#666680" stroke-width="2" rx="2"/></svg>
          <span class="fmt-name">9:16</span>
        </div>
        <div class="format-btn" onclick="setFormat(this,'landscape')" title="16:9">
          <svg class="fmt-icon" width="30" height="18" viewBox="0 0 30 18"><rect x="1" y="1" width="28" height="16" fill="none" stroke="#666680" stroke-width="2" rx="2"/></svg>
          <span class="fmt-name">16:9</span>
        </div>
        <div class="format-btn" onclick="setFormat(this,'cinematic')" title="2.39:1">
          <svg class="fmt-icon" width="32" height="14" viewBox="0 0 32 14"><rect x="1" y="1" width="30" height="12" fill="none" stroke="#666680" stroke-width="2" rx="2"/></svg>
          <span class="fmt-name">CINEMA</span>
        </div>
        <div class="format-btn" onclick="setFormat(this,'original')" title="Original">
          <svg class="fmt-icon" width="24" height="20" viewBox="0 0 24 20"><rect x="1" y="1" width="22" height="18" fill="none" stroke="#666680" stroke-width="2" rx="2"/><line x1="1" y1="19" x2="23" y2="1" stroke="#666680" stroke-width="1"/></svg>
          <span class="fmt-name">ORIG</span>
        </div>
      </div>
    </div>

    <!-- PRESETS -->
    <div class="panel-section">
      <div class="panel-label">Presets</div>
      <div class="presets-grid" id="presets-container">
        <!-- Generated by JS -->
      </div>
    </div>

    <!-- FRAMES -->
    <div class="panel-section">
      <div class="panel-label">Frames</div>
      <div class="frames-grid">
        <div class="frame-btn active" onclick="setFrame(this,'none')" title="No frame">‚òê</div>
        <div class="frame-btn" onclick="setFrame(this,'thin')" title="Thin border">‚ñ≠</div>
        <div class="frame-btn" onclick="setFrame(this,'thick')" title="Thick white">‚ó´</div>
        <div class="frame-btn" onclick="setFrame(this,'shadow')" title="Drop shadow">‚ä°</div>
        <div class="frame-btn pro-locked" onclick="openModal()" title="Film strip (PRO)">üéû</div>
        <div class="frame-btn pro-locked" onclick="openModal()" title="Polaroid (PRO)">üì∑</div>
      </div>
    </div>

  </div>

  <!-- CENTER -->
  <div class="center" id="drop-target">

    <div class="center-bg"></div>

    <!-- DROP ZONE -->
    <div class="drop-zone" id="drop-zone">
      <div class="drop-zone-label">DROP YOUR<br>PHOTO HERE</div>
      <div class="drop-zone-sub">PNG, JPG, WEBP ‚Äî up to 20MB</div>
      <button class="btn-upload" onclick="document.getElementById('file-input').click()">
        + UPLOAD PHOTO
      </button>
      <input type="file" id="file-input" accept="image/*" onchange="loadFile(this)">
    </div>

    <!-- CANVAS -->
    <div class="canvas-wrapper" id="canvas-wrapper">
      <canvas id="main-canvas" width="800" height="800"></canvas>
      <div class="ba-hint" id="ba-hint">HOLD ‚éµ TO COMPARE</div>
      <div class="canvas-actions">
        <button class="btn-action" onclick="document.getElementById('file-input').click()">‚Üë NEW PHOTO</button>
        <button class="btn-action compare-btn" id="compare-btn" onmousedown="startCompare()" onmouseup="stopCompare()" ontouchstart="startCompare()" ontouchend="stopCompare()">‚ä° BEFORE</button>
        <button class="btn-action" onclick="resetEdits()">‚Ü∫ RESET</button>
        <button class="btn-action btn-export" onclick="exportImage()">‚Üì EXPORT</button>
      </div>
    </div>

  </div>

  <!-- RIGHT: Adjustments / Text / Stickers -->
  <div class="right-panel">

    <!-- TABS -->
    <div class="tabs">
      <div class="tab active" onclick="showTab(this,'adjust')">ADJUST</div>
      <div class="tab" onclick="showTab(this,'text')">TEXT</div>
      <div class="tab" onclick="showTab(this,'stickers')">VIBES</div>
    </div>

    <!-- ADJUST TAB -->
    <div class="tab-content active" id="tab-adjust">
      <!-- Histogram -->
      <div class="histogram-wrap">
        <canvas id="histogram" width="228" height="50"></canvas>
      </div>

      <div class="panel-section">
        <div class="panel-label">Light</div>
        <div class="slider-row">
          <span class="slider-label">Brightness</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'brightness')" /></div>
          <span class="slider-val" id="val-brightness">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Contrast</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'contrast')" /></div>
          <span class="slider-val" id="val-contrast">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Highlights</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'highlights')" /></div>
          <span class="slider-val" id="val-highlights">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Shadows</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'shadows')" /></div>
          <span class="slider-val" id="val-shadows">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Exposure</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'exposure')" /></div>
          <span class="slider-val" id="val-exposure">0</span>
        </div>
      </div>

      <div class="panel-section">
        <div class="panel-label">Color</div>
        <div class="slider-row">
          <span class="slider-label">Saturation</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'saturation')" /></div>
          <span class="slider-val" id="val-saturation">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Vibrance</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'vibrance')" /></div>
          <span class="slider-val" id="val-vibrance">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Temperature</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'temperature')" /></div>
          <span class="slider-val" id="val-temperature">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Tint</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'tint')" /></div>
          <span class="slider-val" id="val-tint">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Hue</span>
          <div class="slider-wrap"><input type="range" min="-180" max="180" value="0" oninput="updateSlider(this,'hue')" /></div>
          <span class="slider-val" id="val-hue">0</span>
        </div>
      </div>

      <div class="panel-section">
        <div class="panel-label">Detail</div>
        <div class="slider-row">
          <span class="slider-label">Sharpness</span>
          <div class="slider-wrap"><input type="range" min="0" max="100" value="0" oninput="updateSlider(this,'sharpness')" /></div>
          <span class="slider-val" id="val-sharpness">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Clarity</span>
          <div class="slider-wrap"><input type="range" min="-100" max="100" value="0" oninput="updateSlider(this,'clarity')" /></div>
          <span class="slider-val" id="val-clarity">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Grain</span>
          <div class="slider-wrap"><input type="range" min="0" max="100" value="0" oninput="updateSlider(this,'grain')" /></div>
          <span class="slider-val" id="val-grain">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Vignette</span>
          <div class="slider-wrap"><input type="range" min="0" max="100" value="0" oninput="updateSlider(this,'vignette')" /></div>
          <span class="slider-val" id="val-vignette">0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Fade</span>
          <div class="slider-wrap"><input type="range" min="0" max="100" value="0" oninput="updateSlider(this,'fade')" /></div>
          <span class="slider-val" id="val-fade">0</span>
        </div>
      </div>

      <!-- Ad Banner -->
      <div class="ad-banner">
        <div class="ad-label">ADVERTISEMENT</div>
        <div class="ad-text">‚ú¶ Unlock 50+ Presets</div>
        <div class="ad-sub">Go PRO for $4.99/mo ‚Äî no watermarks</div>
      </div>

    </div>

    <!-- TEXT TAB -->
    <div class="tab-content" id="tab-text">
      <div class="text-tools">
        <div class="text-input-group">
          <label>TEXT CONTENT</label>
          <textarea id="text-content" placeholder="Your caption here..."></textarea>
        </div>
        <div class="text-input-group">
          <label>FONT STYLE</label>
          <select id="text-font">
            <option value="Bebas Neue">BEBAS NEUE ‚Äî Bold</option>
            <option value="DM Sans">DM Sans ‚Äî Clean</option>
            <option value="Space Mono">Space Mono ‚Äî Technical</option>
            <option value="Georgia">Georgia ‚Äî Elegant</option>
            <option value="Impact">Impact ‚Äî Heavy</option>
          </select>
        </div>
        <div class="text-input-group">
          <label>SIZE</label>
          <input type="range" min="12" max="120" value="48" id="text-size" oninput="updateTextPreview()">
        </div>
        <div class="text-input-group">
          <label>TEXT COLOR</label>
          <div class="color-row">
            <div class="color-swatch active" style="background:#ffffff" onclick="selectColor(this,'#ffffff')"></div>
            <div class="color-swatch" style="background:#000000" onclick="selectColor(this,'#000000')"></div>
            <div class="color-swatch" style="background:#ff3c6e" onclick="selectColor(this,'#ff3c6e')"></div>
            <div class="color-swatch" style="background:#00e5c5" onclick="selectColor(this,'#00e5c5')"></div>
            <div class="color-swatch" style="background:#ffb830" onclick="selectColor(this,'#ffb830')"></div>
            <div class="color-swatch" style="background:#a855f7" onclick="selectColor(this,'#a855f7')"></div>
            <div class="color-swatch" style="background:#3b82f6" onclick="selectColor(this,'#3b82f6')"></div>
            <div class="color-swatch" style="background:#f97316" onclick="selectColor(this,'#f97316')"></div>
          </div>
        </div>
        <div class="text-input-group">
          <label>POSITION X / Y</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <input type="range" min="0" max="100" value="50" id="text-x" oninput="updateTextPreview()">
            <input type="range" min="0" max="100" value="75" id="text-y" oninput="updateTextPreview()">
          </div>
        </div>
        <button class="btn-add-text" onclick="addTextOverlay()">+ ADD TO PHOTO</button>
        <button class="btn-add-text" style="margin-top:8px;border-color:var(--accent);color:var(--accent);background:rgba(255,60,110,0.05)" onclick="clearTexts()">‚úï CLEAR ALL TEXT</button>
      </div>
    </div>

    <!-- STICKERS TAB -->
    <div class="tab-content" id="tab-stickers">
      <div class="panel-section" style="border:none;padding:12px 16px 0">
        <div class="panel-label">Stickers & Vibes</div>
      </div>
      <div class="stickers-grid" id="stickers-grid">
        <!-- Populated by JS -->
      </div>
      <div class="panel-section">
        <div class="ad-banner">
          <div class="ad-label">HINT</div>
          <div class="ad-text">Click sticker ‚Üí places on photo</div>
          <div class="ad-sub">PRO unlocks 200+ premium stickers</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- PRO MODAL -->
<div class="modal-overlay" id="pro-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h2>GO <span>PRO</span></h2>
    <p>Remove watermarks, unlock 50+ presets, 200+ stickers, batch export, and high-res 4K downloads.</p>
    <div class="plans">
      <div class="plan" onclick="selectPlan(this)">
        <div class="plan-price">$4<span style="font-size:16px">.99</span></div>
        <div class="plan-period">/MONTH</div>
        <ul class="plan-features">
          <li>50+ Presets</li>
          <li>No watermark</li>
          <li>4K Export</li>
          <li>All frames</li>
        </ul>
      </div>
      <div class="plan featured" onclick="selectPlan(this)">
        <div class="plan-price">$29<span style="font-size:16px">.99</span></div>
        <div class="plan-period">/YEAR</div>
        <ul class="plan-features">
          <li>Everything in PRO</li>
          <li>200+ Stickers</li>
          <li>Batch editing</li>
          <li>Priority support</li>
        </ul>
      </div>
    </div>
    <button class="btn-subscribe" onclick="closeModal(); showToast('üéâ PRO coming soon ‚Äî stay tuned!')">START FREE TRIAL ‚Äî 7 DAYS</button>
    <div class="modal-footer">Cancel anytime ¬∑ No credit card required for trial</div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let originalImageData = null;
let img = null;
let currentFormat = 'square';
let currentFrame = 'none';
let textOverlays = [];
let selectedTextColor = '#ffffff';
let comparing = false;
let activePreset = null;

const adjustments = {
  brightness: 0, contrast: 0, saturation: 0, vibrance: 0,
  temperature: 0, tint: 0, highlights: 0, shadows: 0,
  exposure: 0, sharpness: 0, clarity: 0, grain: 0, vignette: 0,
  fade: 0, hue: 0
};

const presets = [
  { name: 'NOIR', filters: { brightness: -10, contrast: 30, saturation: -80, grain: 30, vignette: 40 }, free: true },
  { name: 'CHROME', filters: { brightness: 5, contrast: -10, saturation: -30, temperature: 10, fade: 20 }, free: true },
  { name: 'GOLDEN', filters: { brightness: 15, temperature: 50, saturation: 20, fade: 10, vignette: 20 }, free: true },
  { name: 'FILM', filters: { contrast: 20, saturation: -20, grain: 40, fade: 15, highlights: -20 }, free: true },
  { name: 'MATTE', filters: { contrast: -15, saturation: -10, fade: 35, brightness: 5 }, free: false },
  { name: 'ARCTIC', filters: { brightness: 20, temperature: -60, saturation: -20, contrast: 10 }, free: false },
  { name: 'EMBER', filters: { temperature: 80, saturation: 30, brightness: -5, vignette: 30, contrast: 15 }, free: false },
  { name: 'VELVET', filters: { saturation: 30, contrast: 25, vignette: 50, clarity: 20, highlights: -15 }, free: false },
];

const stickers = ['üî•','‚ú®','üí´','üéØ','‚ù§Ô∏è','üåô','‚ö°','üåä','üéµ','ü¶ã','üå∏','üçÄ','üé®','üíé','üåà','ü¶Ñ','üëë','üåü','üé≠','üé™','üç≠','üå∫','ü¶Ö','üèîÔ∏è','üåÉ','üí•','üé∏','üåô','üîÆ','ü¶ä'];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT PRESETS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initPresets() {
  const container = document.getElementById('presets-container');
  presets.forEach((p, i) => {
    const btn = document.createElement('div');
    btn.className = 'preset-btn' + (p.free ? '' : ' pro-locked');
    btn.innerHTML = `<canvas class="preset-canvas" id="preset-canvas-${i}" width="80" height="56"></canvas><div class="preset-name">${p.name}</div>`;
    btn.onclick = () => p.free ? applyPreset(p, btn) : openModal();
    container.appendChild(btn);
  });
}

function drawPresetThumbs() {
  if (!img) return;
  presets.forEach((p, i) => {
    const c = document.getElementById(`preset-canvas-${i}`);
    if (!c) return;
    const ctx = c.getContext('2d');
    ctx.drawImage(img, 0, 0, c.width, c.height);
    applyFiltersToCtx(ctx, c.width, c.height, p.filters);
  });
}

function initStickers() {
  const g = document.getElementById('stickers-grid');
  stickers.forEach((s, i) => {
    const d = document.createElement('div');
    d.className = 'sticker' + (i >= 16 ? ' pro' : '');
    d.textContent = s;
    d.onclick = () => i >= 16 ? openModal() : addSticker(s);
    g.appendChild(d);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// FILE LOADING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadFile(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    img = new Image();
    img.onload = () => {
      showEditor();
      resetEdits();
      drawPresetThumbs();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// Drag & drop
const dropTarget = document.getElementById('drop-target');
dropTarget.addEventListener('dragover', e => { e.preventDefault(); });
dropTarget.addEventListener('drop', e => {
  e.preventDefault();
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = ev => {
      img = new Image();
      img.onload = () => { showEditor(); resetEdits(); drawPresetThumbs(); };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  }
});

function showEditor() {
  document.getElementById('drop-zone').style.display = 'none';
  document.getElementById('canvas-wrapper').classList.add('visible');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER ENGINE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getCanvasDimensions() {
  if (!img) return { w: 800, h: 800 };
  const ratio = {
    square: 1, portrait: 0.8, story: 9/16, landscape: 16/9,
    cinematic: 1/2.39, original: img.width / img.height
  }[currentFormat];
  const maxW = 700;
  const w = maxW;
  const h = Math.round(maxW / (img.width / img.height));
  return { w, h };
}

function render() {
  if (!img) return;
  const canvas = document.getElementById('main-canvas');
  const { w, h } = getCanvasDimensions();
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d');

  // Draw image
  if (currentFormat === 'original') {
    ctx.drawImage(img, 0, 0, w, h);
  } else {
    // Cover fill
    const scale = Math.max(w / img.width, h / img.height);
    const sw = img.width * scale, sh = img.height * scale;
    const sx = (w - sw) / 2, sy = (h - sh) / 2;
    ctx.drawImage(img, sx, sy, sw, sh);
  }

  // Apply filters
  applyFiltersToCtx(ctx, w, h, adjustments);

  // Apply frame
  applyFrame(ctx, w, h);

  // Render text overlays
  textOverlays.forEach(t => {
    ctx.save();
    ctx.font = `${t.size}px '${t.font}'`;
    ctx.fillStyle = t.color;
    ctx.shadowColor = 'rgba(0,0,0,0.5)';
    ctx.shadowBlur = 8;
    ctx.textAlign = 'center';
    ctx.fillText(t.text, w * t.x / 100, h * t.y / 100);
    ctx.restore();
  });

  // Update histogram
  drawHistogram(ctx.getImageData(0, 0, w, h));
}

function applyFiltersToCtx(ctx, w, h, adj) {
  const imageData = ctx.getImageData(0, 0, w, h);
  const data = imageData.data;
  const len = data.length;

  const br = adj.brightness || 0;
  const co = adj.contrast || 0;
  const sat = adj.saturation || 0;
  const temp = adj.temperature || 0;
  const tint = adj.tint || 0;
  const hi = adj.highlights || 0;
  const sh = adj.shadows || 0;
  const exp = adj.exposure || 0;
  const fade = adj.fade || 0;
  const hue = adj.hue || 0;
  const vibrance = adj.vibrance || 0;

  const contrastFactor = (259 * (co + 255)) / (255 * (259 - co));
  const expFactor = Math.pow(2, exp / 100 * 2);

  for (let i = 0; i < len; i += 4) {
    let r = data[i], g = data[i+1], b = data[i+2];

    // Exposure
    r *= expFactor; g *= expFactor; b *= expFactor;

    // Brightness
    r += br * 2.55; g += br * 2.55; b += br * 2.55;

    // Contrast
    r = contrastFactor * (r - 128) + 128;
    g = contrastFactor * (g - 128) + 128;
    b = contrastFactor * (b - 128) + 128;

    // Temperature (warm/cool)
    r += temp * 0.8;
    b -= temp * 0.8;
    g += temp * 0.1;

    // Tint
    g += tint * 0.5;
    r -= tint * 0.2;

    // Highlights / Shadows
    const lum = 0.299 * r + 0.587 * g + 0.114 * b;
    if (lum > 128) {
      const f = (lum - 128) / 127;
      r += hi * f * 0.5; g += hi * f * 0.5; b += hi * f * 0.5;
    } else {
      const f = 1 - lum / 128;
      r += sh * f * 0.5; g += sh * f * 0.5; b += sh * f * 0.5;
    }

    // Saturation
    const gray = 0.299 * r + 0.587 * g + 0.114 * b;
    r = gray + (r - gray) * (1 + sat / 100);
    g = gray + (g - gray) * (1 + sat / 100);
    b = gray + (b - gray) * (1 + sat / 100);

    // Vibrance (smart saturation)
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const curSat = max === 0 ? 0 : (max - min) / max;
    const vibF = (1 - curSat) * (vibrance / 100);
    const vGray = 0.299 * r + 0.587 * g + 0.114 * b;
    r = vGray + (r - vGray) * (1 + vibF);
    g = vGray + (g - vGray) * (1 + vibF);
    b = vGray + (b - vGray) * (1 + vibF);

    // Hue rotation (simplified)
    if (hue !== 0) {
      const h = hue * Math.PI / 180;
      const cosH = Math.cos(h), sinH = Math.sin(h);
      const nr = r * (0.299 + 0.701*cosH + 0.168*sinH)
               + g * (0.587 - 0.587*cosH + 0.330*sinH)
               + b * (0.114 - 0.114*cosH - 0.497*sinH);
      const ng = r * (0.299 - 0.299*cosH - 0.328*sinH)
               + g * (0.587 + 0.413*cosH + 0.035*sinH)
               + b * (0.114 - 0.114*cosH + 0.292*sinH);
      const nb = r * (0.299 - 0.300*cosH + 1.250*sinH)
               + g * (0.587 - 0.588*cosH - 1.050*sinH)
               + b * (0.114 + 0.886*cosH - 0.203*sinH);
      r = nr; g = ng; b = nb;
    }

    // Fade
    r = r + (255 - r) * (fade / 200);
    g = g + (255 - g) * (fade / 200);
    b = b + (255 - b) * (fade / 200);

    data[i] = Math.max(0, Math.min(255, r));
    data[i+1] = Math.max(0, Math.min(255, g));
    data[i+2] = Math.max(0, Math.min(255, b));
  }

  ctx.putImageData(imageData, 0, 0);

  // Grain
  if (adj.grain > 0) {
    const grainIntensity = adj.grain / 100 * 60;
    const grainData = ctx.getImageData(0, 0, w, h);
    for (let i = 0; i < grainData.data.length; i += 4) {
      const n = (Math.random() - 0.5) * grainIntensity;
      grainData.data[i] = Math.max(0, Math.min(255, grainData.data[i] + n));
      grainData.data[i+1] = Math.max(0, Math.min(255, grainData.data[i+1] + n));
      grainData.data[i+2] = Math.max(0, Math.min(255, grainData.data[i+2] + n));
    }
    ctx.putImageData(grainData, 0, 0);
  }

  // Vignette
  if (adj.vignette > 0) {
    const gradient = ctx.createRadialGradient(w/2, h/2, Math.min(w,h)*0.3, w/2, h/2, Math.max(w,h)*0.8);
    gradient.addColorStop(0, 'rgba(0,0,0,0)');
    gradient.addColorStop(1, `rgba(0,0,0,${adj.vignette / 100 * 0.85})`);
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, w, h);
  }

  // Clarity (edge contrast boost approximation via overlay)
  if (adj.clarity && adj.clarity !== 0) {
    ctx.save();
    ctx.globalCompositeOperation = adj.clarity > 0 ? 'overlay' : 'screen';
    ctx.globalAlpha = Math.abs(adj.clarity) / 100 * 0.3;
    ctx.filter = 'blur(8px) contrast(150%)';
    ctx.drawImage(ctx.canvas, 0, 0);
    ctx.restore();
  }
}

function applyFrame(ctx, w, h) {
  if (currentFrame === 'none') return;
  if (currentFrame === 'thin') {
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 4;
    ctx.strokeRect(2, 2, w-4, h-4);
  } else if (currentFrame === 'thick') {
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 20;
    ctx.strokeRect(10, 10, w-20, h-20);
  } else if (currentFrame === 'shadow') {
    ctx.save();
    ctx.shadowColor = 'rgba(0,0,0,0.6)';
    ctx.shadowBlur = 30;
    ctx.strokeStyle = 'rgba(255,255,255,0.9)';
    ctx.lineWidth = 12;
    ctx.strokeRect(6, 6, w-12, h-12);
    ctx.restore();
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SLIDER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateSlider(input, key) {
  adjustments[key] = parseInt(input.value);
  document.getElementById(`val-${key}`).textContent = input.value;
  activePreset = null;
  document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
  render();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PRESETS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyPreset(preset, btn) {
  Object.keys(adjustments).forEach(k => adjustments[k] = 0);
  Object.assign(adjustments, preset.filters);
  // Sync sliders
  document.querySelectorAll('input[type=range]').forEach(input => {
    const key = input.closest('.slider-row')?.querySelector('.slider-label')?.textContent?.toLowerCase().trim();
    if (key && adjustments[key] !== undefined) {
      input.value = adjustments[key];
      const val = document.getElementById(`val-${key}`);
      if (val) val.textContent = adjustments[key];
    }
  });
  document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// FORMAT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setFormat(btn, fmt) {
  currentFormat = fmt;
  document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function setFrame(btn, frame) {
  currentFrame = frame;
  document.querySelectorAll('.frame-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RESET
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetEdits() {
  Object.keys(adjustments).forEach(k => adjustments[k] = 0);
  document.querySelectorAll('input[type=range]').forEach(i => {
    if (i.id === 'text-size' || i.id === 'text-x' || i.id === 'text-y') return;
    i.value = i.min > 0 ? i.min : 0;
    i.value = 0;
  });
  document.querySelectorAll('.slider-val').forEach(v => v.textContent = '0');
  textOverlays = [];
  currentFrame = 'none';
  document.querySelectorAll('.frame-btn').forEach((b, i) => b.classList.toggle('active', i === 0));
  document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
  render();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// COMPARE (before/after)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startCompare() {
  if (!img) return;
  comparing = true;
  const btn = document.getElementById('compare-btn');
  btn.classList.add('comparing');
  const canvas = document.getElementById('main-canvas');
  const ctx = canvas.getContext('2d');
  const { w, h } = getCanvasDimensions();
  const scale = Math.max(w / img.width, h / img.height);
  const sw = img.width * scale, sh = img.height * scale;
  const sx = (w - sw) / 2, sy = (h - sh) / 2;
  ctx.clearRect(0, 0, w, h);
  ctx.drawImage(img, sx, sy, sw, sh);
}

function stopCompare() {
  if (!comparing) return;
  comparing = false;
  document.getElementById('compare-btn').classList.remove('comparing');
  render();
}

document.addEventListener('keydown', e => { if (e.code === 'Space') { e.preventDefault(); startCompare(); } });
document.addEventListener('keyup', e => { if (e.code === 'Space') stopCompare(); });

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TEXT OVERLAY
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addTextOverlay() {
  const text = document.getElementById('text-content').value.trim();
  if (!text || !img) return;
  textOverlays.push({
    text,
    font: document.getElementById('text-font').value,
    size: parseInt(document.getElementById('text-size').value),
    color: selectedTextColor,
    x: parseInt(document.getElementById('text-x').value),
    y: parseInt(document.getElementById('text-y').value),
  });
  render();
  showToast('Text added to photo');
}

function clearTexts() {
  textOverlays = [];
  render();
}

function selectColor(el, color) {
  selectedTextColor = color;
  document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
}

function updateTextPreview() { }

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STICKERS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addSticker(emoji) {
  if (!img) { showToast('Upload a photo first'); return; }
  textOverlays.push({
    text: emoji,
    font: 'Arial',
    size: 60,
    color: 'white',
    x: 30 + Math.random() * 40,
    y: 30 + Math.random() * 40,
  });
  render();
  showToast(`${emoji} added!`);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// EXPORT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportImage() {
  if (!img) return;

  // Free plan watermark
  const canvas = document.getElementById('main-canvas');
  const ctx = canvas.getContext('2d');
  ctx.save();
  ctx.font = "bold 13px 'Space Mono', monospace";
  ctx.fillStyle = 'rgba(255,255,255,0.6)';
  ctx.textAlign = 'right';
  ctx.fillText('made with LUMIX', canvas.width - 12, canvas.height - 12);
  ctx.restore();

  const link = document.createElement('a');
  link.download = 'lumix-edit.jpg';
  link.href = canvas.toDataURL('image/jpeg', 0.95);
  link.click();

  // Re-render to remove watermark from view
  setTimeout(render, 100);
  showToast('Photo exported! ‚úì');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HISTOGRAM
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawHistogram(imageData) {
  const canvas = document.getElementById('histogram');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const r = new Array(256).fill(0);
  const g = new Array(256).fill(0);
  const b = new Array(256).fill(0);
  const data = imageData.data;
  for (let i = 0; i < data.length; i += 4) {
    r[data[i]]++; g[data[i+1]]++; b[data[i+2]]++;
  }
  const maxV = Math.max(...r, ...g, ...b);

  const draw = (arr, color) => {
    ctx.beginPath();
    ctx.fillStyle = color;
    for (let i = 0; i < 256; i++) {
      const x = i / 256 * canvas.width;
      const h = (arr[i] / maxV) * canvas.height;
      ctx.fillRect(x, canvas.height - h, canvas.width / 256, h);
    }
  };

  draw(r, 'rgba(255,60,110,0.5)');
  draw(g, 'rgba(0,229,197,0.5)');
  draw(b, 'rgba(56,130,255,0.5)');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TABS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(btn, tabId) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(`tab-${tabId}`).classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MODAL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal() {
  document.getElementById('pro-modal').classList.add('show');
}
function closeModal() {
  document.getElementById('pro-modal').classList.remove('show');
}
function selectPlan(el) {
  document.querySelectorAll('.plan').forEach(p => p.classList.remove('featured'));
  el.classList.add('featured');
}

document.getElementById('pro-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('pro-modal')) closeModal();
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TOAST
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
initPresets();
initStickers();

// Keyboard shortcuts hint on load
setTimeout(() => showToast('Tip: Drag & drop photos directly!'), 1000);
</script>
</body>
</html>
